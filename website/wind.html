<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="UTF-8">
  <title>map</title>
  <style type="text/css">
    html, body, #map {
      padding: 0px;
      margin:0px;
      height:100%;
      width:100%
    }
  </style>
</head>
<body>
<canvas id="map"></canvas>
<script src="../packages/core/dist/webgl-wind.js"></script>
<script type="text/javascript">
  const canvas = document.getElementById('map');
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight;
  const createContext = function (canvas, glOptions = {}) {
    if (!canvas) return null;
    function onContextCreationError (error) {
      console.log(error.statusMessage);
    }

    canvas.addEventListener('webglcontextcreationerror', onContextCreationError, false);
    let gl = canvas.getContext('webgl', glOptions);
    gl = gl || canvas.getContext('experimental-webgl', glOptions);
    if (!gl) {
      gl = canvas.getContext('webgl2', glOptions);
      gl = gl || canvas.getContext('experimental-webgl2', glOptions);
    }

    canvas.removeEventListener('webglcontextcreationerror', onContextCreationError, false);
    return gl;
  };
  const context = createContext(canvas, {
    // 'alpha': true,
    // 'antialias': true,
    // 'preserveDrawingBuffer': true
  });

  function getJSON(url, callback) {
    const xhr = new XMLHttpRequest();
    xhr.responseType = 'json';
    xhr.open('get', url, true);
    xhr.onload = function () {
      if (xhr.status >= 200 && xhr.status < 300) {
        callback(xhr.response);
      } else {
        throw new Error(xhr.statusText);
      }
    };
    xhr.send();
  }

  console.log(context);

  const wind = new WindGL.default(context, {});

  function draw () {
    wind.render(JSON.parse("[3770.804809734272,0,0,0,0,-14685.487291460046,0,0,0,0,-4908.288037791965,-4895.162430486682,-2994.5333865497773,5668.44799568952,739.480171471856,739.5]"))
    requestAnimationFrame(draw);
  }

  getJSON('static/wind/2016112000.json', function (windData) {
    const windImage = new Image();
    windImage.src = 'static/wind/2016112000.png';
    windImage.onload = function () {
      wind.setWind(windData, windImage);
      draw();
    };
  });

  console.log(wind)
</script>
</body>
</html>
